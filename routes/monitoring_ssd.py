# -*- coding: utf-8 -*-

dashboard_summary = {
    'dbms_type': 'MySQL',
    'db_size': '196 (GB)',
    'db_name': 'tpc-h',
    'storage_type': 'SSD',
    'db_user': 'keti',
    'workbench_user': 'User 1234',
    'db_host_ip': '10.0.4.80:40001',
    'data_store_type': 'Row Base',
}

ddl_info = [
    {
        'timestamp': '14:50:00',
        'select_count': 20,
        'insert_count': 15,
        'delete_count': 17,
        'update_count': 10
    },
    {
        'timestamp': '14:50:10',
        'select_count': 19,
        'insert_count': 10,
        'delete_count': 11,
        'update_count': 8
    },
    {
        'timestamp': '14:50:20',
        'select_count': 8,
        'insert_count': 15,
        'delete_count': 12,
        'update_count': 2
    },
    {
        'timestamp': '14:50:30',
        'select_count': 18,
        'insert_count': 12,
        'delete_count': 13,
        'update_count': 9
    },
    {
        'timestamp': '14:50:40',
        'select_count': 12,
        'insert_count': 15,
        'delete_count': 10,
        'update_count': 5
    },
    {
        'timestamp': '14:50:50',
        'select_count': 12,
        'insert_count': 17,
        'delete_count': 19,
        'update_count': 22
    },
    {
        'timestamp': '14:51:00',
        'select_count': 13,
        'insert_count': 16,
        'delete_count': 2,
        'update_count': 9
    },
    {
        'timestamp': '14:51:10',
        'select_count': 5,
        'insert_count': 15,
        'delete_count': 9,
        'update_count': 19
    },
    {
        'timestamp': '14:51:20',
        'select_count': 22,
        'insert_count': 17,
        'delete_count': 11,
        'update_count': 13
    },
    {
        'timestamp': '14:51:30',
        'select_count': 16,
        'insert_count': 10,
        'delete_count': 12,
        'update_count': 7
    },
    {
        'timestamp': '14:51:40',
        'select_count': 12,
        'insert_count': 8,
        'delete_count': 2,
        'update_count': 5
    },
    {
        'timestamp': '14:51:50',
        'select_count': 16,
        'insert_count': 22,
        'delete_count': 5,
        'update_count': 16
    },
    {
        'timestamp': '14:52:00',
        'select_count': 11,
        'insert_count': 22,
        'delete_count': 16,
        'update_count': 19
    },
    {
        'timestamp': '14:52:10',
        'select_count': 25,
        'insert_count': 10,
        'delete_count': 12,
        'update_count': 13
    },
    {
        'timestamp': '14:52:20',
        'select_count': 16,
        'insert_count': 12,
        'delete_count': 13,
        'update_count': 19
    },
    {
        'timestamp': '14:52:30',
        'select_count': 17,
        'insert_count': 5,
        'delete_count': 16,
        'update_count': 6
    },
    {
        'timestamp': '14:52:40',
        'select_count': 16,
        'insert_count': 19,
        'delete_count': 12,
        'update_count': 16
    },
    {
        'timestamp': '14:52:50',
        'select_count': 20,
        'insert_count': 13,
        'delete_count': 18,
        'update_count': 4
    },
    {
        'timestamp': '14:53:00',
        'select_count': 26,
        'insert_count': 15,
        'delete_count': 17,
        'update_count': 9
    },
    {
        'timestamp': '14:53:10',
        'select_count': 15,
        'insert_count': 19,
        'delete_count': 4,
        'update_count': 8
    }
]

connected_client = [
    {
        "timestamp": "14:50:00",
        "client": 1
    },
    {
        "timestamp": "14:50:10",
        "client": 1
    },
    {
        "timestamp": "14:50:20",
        "client": 14
    },
    {
        "timestamp": "14:50:30",
        "client": 2
    },
    {
        "timestamp": "14:50:40",
        "client": 7
    },
    {
        "timestamp": "14:50:50",
        "client": 1
    },
    {
        "timestamp": "14:51:00",
        "client": 14
    },
    {
        "timestamp": "14:51:10",
        "client": 12
    },
    {
        "timestamp": "14:51:20",
        "client": 3
    },
    {
        "timestamp": "14:51:30",
        "client": 2
    },
    {
        "timestamp": "14:51:40",
        "client": 1
    },
    {
        "timestamp": "14:51:50",
        "client": 12
    },
    {
        "timestamp": "14:52:00",
        "client": 11
    },
    {
        "timestamp": "14:52:10",
        "client": 8
    },
    {
        "timestamp": "14:52:20",
        "client": 10
    },
    {
        "timestamp": "14:52:30",
        "client": 15
    },
    {
        "timestamp": "14:52:40",
        "client": 10
    },
    {
        "timestamp": "14:52:50",
        "client": 1
    },
    {
        "timestamp": "14:53:00",
        "client": 6
    },
    {
        "timestamp": "14:53:10",
        "client": 1
    }
]

disk_rw_info = [
  {
    "timestamp": "14:50:00",
    "disk_read": 555,
    "disk_write": 557
  },
  {
    "timestamp": "14:50:10",
    "disk_read": 882,
    "disk_write": 218
  },
  {
    "timestamp": "14:50:20",
    "disk_read": 808,
    "disk_write": 111
  },
  {
    "timestamp": "14:50:30",
    "disk_read": 554,
    "disk_write": 338
  },
  {
    "timestamp": "14:50:40",
    "disk_read": 880,
    "disk_write": 346
  },
  {
    "timestamp": "14:50:50",
    "disk_read": 757,
    "disk_write": 347
  },
  {
    "timestamp": "14:51:00",
    "disk_read": 553,
    "disk_write": 114
  },
  {
    "timestamp": "14:51:10",
    "disk_read": 818,
    "disk_write": 172
  },
  {
    "timestamp": "14:51:20",
    "disk_read": 891,
    "disk_write": 253
  },
  {
    "timestamp": "14:51:30",
    "disk_read": 805,
    "disk_write": 394
  },
  {
    "timestamp": "14:51:40",
    "disk_read": 599,
    "disk_write": 575
  },
  {
    "timestamp": "14:51:50",
    "disk_read": 511,
    "disk_write": 517
  },
  {
    "timestamp": "14:52:00",
    "disk_read": 525,
    "disk_write": 433
  },
  {
    "timestamp": "14:52:10",
    "disk_read": 856,
    "disk_write": 361
  },
  {
    "timestamp": "14:52:20",
    "disk_read": 796,
    "disk_write": 103
  },
  {
    "timestamp": "14:52:30",
    "disk_read": 788,
    "disk_write": 518
  },
  {
    "timestamp": "14:52:40",
    "disk_read": 626,
    "disk_write": 206
  },
  {
    "timestamp": "14:52:50",
    "disk_read": 803,
    "disk_write": 484
  },
  {
    "timestamp": "14:53:00",
    "disk_read": 793,
    "disk_write": 248
  },
  {
    "timestamp": "14:53:10",
    "disk_read": 676,
    "disk_write": 545
  }
]

cache_usage_info = [
    {
        'timestamp': '14:50:00',
        'cache_hit_rate': 50
    },
    {
        'timestamp': '14:50:10',
        'cache_hit_rate': 53
    },
    {
        'timestamp': '14:50:20',
        'cache_hit_rate': 51
    },
    {
        'timestamp': '14:50:30',
        'cache_hit_rate': 49
    },
    {
        'timestamp': '14:50:40',
        'cache_hit_rate': 45
    },
    {
        'timestamp': '14:50:50',
        'cache_hit_rate': 56
    },
    {
        'timestamp': '14:51:00',
        'cache_hit_rate': 55
    },
    {
        'timestamp': '14:51:10',
        'cache_hit_rate': 59
    },
    {
        'timestamp': '14:51:20',
        'cache_hit_rate': 60
    },
    {
        'timestamp': '14:51:30',
        'cache_hit_rate': 58
    },
    {
        'timestamp': '14:51:40',
        'cache_hit_rate': 56
    },
    {
        'timestamp': '14:51:50',
        'cache_hit_rate': 80
    },
    {
        'timestamp': '14:52:00',
        'cache_hit_rate': 65
    },
    {
        'timestamp': '14:52:10',
        'cache_hit_rate': 70
    },
    {
        'timestamp': '14:52:20',
        'cache_hit_rate': 52
    },
    {
        'timestamp': '14:52:30',
        'cache_hit_rate': 2
    },
    {
        'timestamp': '14:52:40',
        'cache_hit_rate': 19
    },
    {
        'timestamp': '14:52:50',
        'cache_hit_rate': 22
    },
    {
        'timestamp': '14:53:00',
        'cache_hit_rate': 0
    },
    {
        'timestamp': '14:53:10',
        'cache_hit_rate': 10
    }
]

slow_query = [
    
    {
        "timestamp": "14:50:00",
        "slow_query": 32
    },
    {
        "timestamp": "14:50:10",
        "slow_query": 27
    },
    {
        "timestamp": "14:50:20",
        "slow_query": 38
    },
    {
        "timestamp": "14:50:30",
        "slow_query": 26
    },
    {
        "timestamp": "14:50:40",
        "slow_query": 24
    },
    {
        "timestamp": "14:50:50",
        "slow_query": 16
    },
    {
        "timestamp": "14:51:00",
        "slow_query": 27
    },
    {
        "timestamp": "14:51:10",
        "slow_query": 39
    },
    {
        "timestamp": "14:51:20",
        "slow_query": 16
    },
    {
        "timestamp": "14:51:30",
        "slow_query": 39
    },
    {
        "timestamp": "14:51:40",
        "slow_query": 26
    },
    {
        "timestamp": "14:51:50",
        "slow_query": 25
    },
    {
        "timestamp": "14:52:00",
        "slow_query": 11
    },
    {
        "timestamp": "14:52:10",
        "slow_query": 25
    },
    {
        "timestamp": "14:52:20",
        "slow_query": 22
    },
    {
        "timestamp": "14:52:30",
        "slow_query": 25
    },
    {
        "timestamp": "14:52:40",
        "slow_query": 12
    },
    {
        "timestamp": "14:52:50",
        "slow_query": 39
    },
    {
        "timestamp": "14:53:00",
        "slow_query": 20
    },
    {
        "timestamp": "14:53:10",
        "slow_query": 22
    }
]

cpu_usg_info = [
  {
    "timestamp": "14:50:00",
    "storage_cpu_usage": 268,
  },
  {
    "timestamp": "14:50:10",
    "storage_cpu_usage": 141,
  },
  {
    "timestamp": "14:50:20",
    "storage_cpu_usage": 322,
  },
  {
    "timestamp": "14:50:30",
    "storage_cpu_usage": 148,
  },
  {
    "timestamp": "14:50:40",
    "storage_cpu_usage": 469,
  },
  {
    "timestamp": "14:50:50",
    "storage_cpu_usage": 235,
  },
  {
    "timestamp": "14:51:00",
    "storage_cpu_usage": 461,
  },
  {
    "timestamp": "14:51:10",
    "storage_cpu_usage": 466,
  },
  {
    "timestamp": "14:51:20",
    "storage_cpu_usage": 437,
  },
  {
    "timestamp": "14:51:30",
    "storage_cpu_usage": 289,
  },
  {
    "timestamp": "14:51:40",
    "storage_cpu_usage": 448,
  },
  {
    "timestamp": "14:51:50",
    "storage_cpu_usage": 129,
  },
  {
    "timestamp": "14:52:00",
    "storage_cpu_usage": 244,
  },
  {
    "timestamp": "14:52:10",
    "storage_cpu_usage": 376,
  },
  {
    "timestamp": "14:52:20",
    "storage_cpu_usage": 475,
  },
  {
    "timestamp": "14:52:30",
    "storage_cpu_usage": 194,
  },
  {
    "timestamp": "14:52:40",
    "storage_cpu_usage": 140,
  },
  {
    "timestamp": "14:53:00",
    "storage_cpu_usage": 302,
  },
  {
    "timestamp": "14:53:10",
    "storage_cpu_usage": 379,
  }
]

memory_usg_info = [
  {
    "timestamp": "14:50:00",
    "storage_memory_usage": 337,
  },
  {
    "timestamp": "14:50:20",
    "storage_memory_usage": 348,
  },
  {
    "timestamp": "14:50:30",
    "storage_memory_usage": 365,
  },
  {
    "timestamp": "14:50:40",
    "storage_memory_usage": 442,
  },
  {
    "timestamp": "14:50:50",
    "storage_memory_usage": 406,
  },
  {
    "timestamp": "14:51:00",
    "storage_memory_usage": 452,
  },
  {
    "timestamp": "14:51:10",
    "storage_memory_usage": 477,
  },
  {
    "timestamp": "14:51:20",
    "storage_memory_usage": 495,
  },
  {
    "timestamp": "14:51:30",
    "storage_memory_usage": 359,
  },
  {
    "timestamp": "14:51:40",
    "storage_memory_usage": 358,
  },
  {
    "timestamp": "14:51:50",
    "storage_memory_usage": 404,
  },
  {
    "timestamp": "14:52:00",
    "storage_memory_usage": 327,
  },
  {
    "timestamp": "14:52:10",
    "storage_memory_usage": 384,
  },
  {
    "timestamp": "14:52:20",
    "storage_memory_usage": 420,
  },
  {
    "timestamp": "14:52:30",
    "storage_memory_usage": 382,
  },
  {
    "timestamp": "14:52:40",
    "storage_memory_usage": 416,
  },
  {
    "timestamp": "14:52:50",
    "storage_memory_usage": 325,
  },
  {
    "timestamp": "14:53:00",
    "storage_memory_usage": 489,
  },
  {
    "timestamp": "14:53:10",
    "storage_memory_usage": 397,
  }
]

network_usage_info = [
  {
    "timestamp": "14:50:00",
    "storage_network_usage": 169,
  },
  {
    "timestamp": "14:50:10",
    "storage_network_usage": 182,
  },
  {
    "timestamp": "14:50:20",
    "storage_network_usage": 153,
  },
  {
    "timestamp": "14:50:30",
    "storage_network_usage": 111,
  },
  {
    "timestamp": "14:50:40",
    "storage_network_usage": 195,
  },
  {
    "timestamp": "14:50:50",
    "storage_network_usage": 201
  },
  {
    "timestamp": "14:51:00",
    "storage_network_usage": 161
  },
  {
    "timestamp": "14:51:10",
    "storage_network_usage": 295
  },
  {
    "timestamp": "14:51:20",
    "storage_network_usage": 124
  },
  {
    "timestamp": "14:51:30",
    "storage_network_usage": 228
  },
  {
    "timestamp": "14:51:40",
    "storage_network_usage": 112
  },
  {
    "timestamp": "14:51:50",
    "storage_network_usage": 299
  },
  {
    "timestamp": "14:52:00",
    "storage_network_usage": 267
  },
  {
    "timestamp": "14:52:10",
    "storage_network_usage": 250
  },
  {
    "timestamp": "14:52:20",
    "storage_network_usage": 294
  },
  {
    "timestamp": "14:52:30",
    "storage_network_usage": 187
  },
  {
    "timestamp": "14:52:40",
    "storage_network_usage": 280
  },
  {
    "timestamp": "14:52:50",
    "storage_network_usage": 260
  },
  {
    "timestamp": "14:53:00",
    "storage_network_usage": 269
  },
  {
    "timestamp": "14:53:10",
    "storage_network_usage": 142
  }
]

power_usg_info = [
  {
    "timestamp": "14:50:00",
    "storage_power_usage": 641
  },
  {
    "timestamp": "14:50:10",
    "storage_power_usage": 524
  },
  {
    "timestamp": "14:50:20",
    "storage_power_usage": 856
  },
  {
    "timestamp": "14:50:30",
    "storage_power_usage": 797
  },
  {
    "timestamp": "14:50:40",
    "storage_power_usage": 671
  },
  {
    "timestamp": "14:50:50",
    "storage_power_usage": 774
  },
  {
    "timestamp": "14:51:00",
    "storage_power_usage": 920
  },
  {
    "timestamp": "14:51:10",
    "storage_power_usage": 841
  },
  {
    "timestamp": "14:51:20",
    "storage_power_usage": 509
  },
  {
    "timestamp": "14:51:30",
    "storage_power_usage": 912
  },
  {
    "timestamp": "14:51:40",
    "storage_power_usage": 818
  },
  {
    "timestamp": "14:51:50",
    "storage_power_usage": 534
  },
  {
    "timestamp": "14:52:00",
    "storage_power_usage": 772
  },
  {
    "timestamp": "14:52:10",
    "storage_power_usage": 842
  },
  {
    "timestamp": "14:52:20",
    "storage_power_usage": 856
  },
  {
    "timestamp": "14:52:30",
    "storage_power_usage": 559
  },
  {
    "timestamp": "14:52:40",
    "storage_power_usage": 709
  },
  {
    "timestamp": "14:52:50",
    "storage_power_usage": 746
  },
  {
    "timestamp": "14:53:00",
    "storage_power_usage": 912
  },
  {
    "timestamp": "14:53:10",
    "storage_power_usage": 815
  }
]

disk_usage = [
  {
    "timestamp": "14:50:00",
    "disk_usage": 838
  },
  {
    "timestamp": "14:50:10",
    "disk_usage": 614
  },
  {
    "timestamp": "14:50:20",
    "disk_usage": 833
  },
  {
    "timestamp": "14:50:30",
    "disk_usage": 796
  },
  {
    "timestamp": "14:50:40",
    "disk_usage": 710
  },
  {
    "timestamp": "14:50:50",
    "disk_usage": 650
  },
  {
    "timestamp": "14:51:00",
    "disk_usage": 835
  },
  {
    "timestamp": "14:51:10",
    "disk_usage": 622
  },
  {
    "timestamp": "14:51:20",
    "disk_usage": 936
  },
  {
    "timestamp": "14:51:30",
    "disk_usage": 727
  },
  {
    "timestamp": "14:51:40",
    "disk_usage": 886
  },
  {
    "timestamp": "14:51:50",
    "disk_usage": 622
  },
  {
    "timestamp": "14:52:00",
    "disk_usage": 665
  },
  {
    "timestamp": "14:52:10",
    "disk_usage": 676
  },
  {
    "timestamp": "14:52:20",
    "disk_usage": 634
  },
  {
    "timestamp": "14:52:30",
    "disk_usage": 573
  },
  {
    "timestamp": "14:52:40",
    "disk_usage": 751
  },
  {
    "timestamp": "14:52:50",
    "disk_usage": 820
  },
  {
    "timestamp": "14:53:00",
    "disk_usage": 782
  },
  {
    "timestamp": "14:53:10",
    "disk_usage": 804
  }
]

from flask import Blueprint, jsonify, request, render_template
import sys, os
sys.path.append(os.path.dirname(os.path.abspath(os.path.dirname(__file__))))
from connectDB import influx, mysql, info
from collections import deque 

monitoring_ssd_bp = Blueprint('monitoring_ssd', __name__, url_prefix='/monitoring_ssd')

# 오른쪽에서 값이 들어오면 왼쪽부터 삭제됨
ddl_count_outer = deque(maxlen=20)
client_count_outer = deque(maxlen=20)
disk_ratio_outer = deque(maxlen=20)
cache_usage_outer = deque(maxlen=20)
cache_ratio_outer = deque(maxlen=20)

# DDL (delete, insert, select, update 순)
def get_ddl_count():
  query = "SELECT * FROM GLOBAL_STATUS WHERE VARIABLE_NAME = 'Com_select' OR VARIABLE_NAME = 'Com_insert' OR VARIABLE_NAME = 'Com_delete' OR VARIABLE_NAME = 'Com_update'"
  result = mysql.execute_query_mysql_demo("information_schema", query)
  # print(result)
  ddl_count_inner = {}
  for i in range(len(result)):
    ddl_count_inner['timestamp'] = 0
    if result[i]['VARIABLE_NAME'] == 'COM_SELECT':
      ddl_count_inner['select_count'] = result[i]['VARIABLE_VALUE']
    elif result[i]['VARIABLE_NAME'] == 'COM_DELETE':
      ddl_count_inner['delete_count'] = result[i]['VARIABLE_VALUE']
    elif result[i]['VARIABLE_NAME'] == 'COM_INSERT':
      ddl_count_inner['insert_count'] = result[i]['VARIABLE_VALUE']
    elif result[i]['VARIABLE_NAME'] == 'COM_UPDATE':
      ddl_count_inner['update_count'] = result[i]['VARIABLE_VALUE']
  ddl_count_outer.append(ddl_count_inner)
  # print(ddl_count_outer)

# client (시간 추가해야 함)
def get_client_count():
  query = "SHOW STATUS LIKE 'Threads_connected'"
  result = mysql.execute_query_mysql_demo("information_schema", query)
  client_count_inner = {}
  client_count_inner['timestamp'] = 0
  client_count_inner['client'] = int(result[0]['Value'])
  client_count_outer.append(client_count_inner)
  # print(client_count_outer)

# disk r/w (시간 추가해야 함)
def get_disk_rw():
  query = "SELECT * FROM .GLOBAL_STATUS WHERE VARIABLE_NAME LIKE '%ROCKSDB_BYTES_READ%' OR VARIABLE_NAME LIKE '%ROCKSDB_BYTES_WRITTEN%'"
  result = mysql.execute_query_mysql_demo("information_schema", query)
  # print(result)
  disk_ratio_inner = {}
  for i in range(len(result)):
    
    disk_ratio_inner['timestamp'] = 0
    if result[i]['VARIABLE_NAME'] == 'ROCKSDB_BYTES_READ':
      disk_ratio_inner['disk_read'] = int(result[i]['VARIABLE_VALUE'])
    elif result[i]['VARIABLE_NAME'] == 'ROCKSDB_BYTES_WRITTEN':
      disk_ratio_inner['disk_write'] = int(result[i]['VARIABLE_VALUE'])
  disk_ratio_outer.append(disk_ratio_inner)
  # print(disk_ratio_outer)

# cache usage
def get_cache_usage():
  query = "SELECT * FROM information_schema.GLOBAL_STATUS WHERE VARIABLE_NAME LIKE '%ROCKSDB_BLOCK_CACHE_BYTES_READ%' OR VARIABLE_NAME LIKE '%ROCKSDB_BLOCK_CACHE_BYTES_WRITE%'"
  result = mysql.execute_query_mysql_demo("information_schema", query)
  cache_usage_inner = {}
  # print(result)
  for i in range(len(result)):
    cache_usage_inner['timestamp'] = 0
    if result[i]['VARIABLE_NAME'] == 'ROCKSDB_BLOCK_CACHE_BYTES_READ':
      cache_usage_inner['cache_read'] = int(result[i]['VARIABLE_VALUE'])
    elif result[i]['VARIABLE_NAME'] == 'ROCKSDB_BLOCK_CACHE_BYTES_WRITE':
      cache_usage_inner['cache_write'] = int(result[i]['VARIABLE_VALUE'])
  cache_usage_outer.append(cache_usage_inner)
  # print(cache_usage_outer)

# cache hit
def get_cache_ratio():
  query = "SELECT * FROM information_schema.GLOBAL_STATUS WHERE VARIABLE_NAME LIKE '%ROCKSDB_BLOCK_CACHE_HIT%' OR VARIABLE_NAME LIKE '%ROCKSDB_BLOCK_CACHE_MISS%'"
  result = mysql.execute_query_mysql_demo("information_schema", query)
  # print(result)
  cache_ratio_inner = {}
  cache_ratio_inner['timestamp'] = 0
  for i in range(len(result)):
    if result[i]['VARIABLE_NAME'] == 'ROCKSDB_BLOCK_CACHE_HIT':
      # cache_ratio_inner['cache_read'] = result[i]['VARIABLE_VALUE']
      cache_hit = int(result[i]['VARIABLE_VALUE'])
    elif result[i]['VARIABLE_NAME'] == 'ROCKSDB_BLOCK_CACHE_MISS':
      # cache_ratio_inner['cache_write'] = result[i]['VARIABLE_VALUE']
      cache_miss = int(result[i]['VARIABLE_VALUE'])
  cache_ratio_inner['cache_hit_ratio'] = float(cache_hit) / (cache_hit + cache_miss) * 100
  cache_ratio_outer.append(cache_ratio_inner)
  # print(cache_ratio_outer)

get_ddl_count()
get_client_count()
get_disk_rw()
# get_cache_usage()
get_cache_ratio() 

# host server metric
cpu_usage_outer = deque(maxlen=20)
memory_usage_outer = deque(maxlen=20)
disk_usage_outer = deque(maxlen=20)
network_usage_outer = deque(maxlen=20)
power_usage_outer = deque(maxlen=20)

def get_instance_metric():
  query = "select * from instance_node_monitoring order by desc limit 20;"
  result = influx.execute_query_influxdb(info.INSTANCE_METRIC_DB_HOST, info.INSTANCE_METRIC_DB_PORT, info.INSTANCE_METRIC_DB_USER, info.INSTANCE_METRIC_DB_PASSWORD, "node_metric", query)
  # print(result)
  for i in range(len(result[0])):
    cpu_usage_inner = {}
    cpu_usage_inner['timestamp'] = 0
    cpu_usage_inner['storage_cpu_usage'] = result[0][i].get('cpu_usage')

    memory_usage_inner = {}
    memory_usage_inner['timestamp'] = 0
    memory_usage_inner['storage_memory_usage'] = result[0][i].get('memory_usage')
    
    disk_usage_inner = {}
    disk_usage_inner['timestamp'] = 0
    disk_usage_inner['disk_usage'] = result[0][i].get('disk_usage')
    
    network_usage_inner = {}
    network_usage_inner['timestamp'] = 0
    network_rx_byte = result[0][i].get('network_rx_byte')
    network_tx_byte = result[0][i].get('network_tx_byte')
    if network_rx_byte is None or network_tx_byte is None:
      pass
    else:
      network_usage_inner['storage_network_usage'] = result[0][i].get('network_rx_byte') + result[0][i].get('network_tx_byte')

    power_usage_inner = {}
    power_usage_inner['timestamp'] = 0
    power_usage_inner['storage_power_usage'] = result[0][i].get('power_usage')

    cpu_usage_outer.append(cpu_usage_inner)
    memory_usage_outer.append(memory_usage_inner)
    disk_usage_outer.append(disk_usage_inner)
    network_usage_outer.append(network_usage_inner)
    power_usage_outer.append(power_usage_inner)

get_instance_metric()

# print(cpu_usage_outer)

# DB Monitoring - SSD
@monitoring_ssd_bp.route('/')  
def monitoring_ssd():
    return render_template('monitoring-ssd.html', dashboard_summary=dashboard_summary)

# DDL Data Get 요청
@monitoring_ssd_bp.route('/get_queryChart', methods=['GET'])
def get_queryChart():
    print("get ddl chart")
    # return jsonify(ddl_info)
    return jsonify(list(ddl_count_outer))

# 연결된 클라이언트 수 Get 요청
@monitoring_ssd_bp.route('/get_ConnectedClient', methods=['GET'])
def get_ConnectedClient():
    print("get client")
    # return jsonify(connected_client)
    return jsonify(list(client_count_outer))

# Disk R/W Get 요청
@monitoring_ssd_bp.route('/get_ReadWrite', methods=['GET'])
def get_ReadWrite():
    # print("get R/W")
    # return jsonify(disk_rw_info)
    return jsonify(list(disk_ratio_outer))

# Cache Usage Get 요청
@monitoring_ssd_bp.route('/get_CacheUsage', methods=['GET'])
def get_CacheUsage():
    # print("get Cache Usage")
    # return jsonify(cache_usage_info)
    return jsonify(list(cache_usage_outer))

# Slow Query Get 요청
@monitoring_ssd_bp.route('/get_SlowQuery', methods=['GET'])
def get_SlowQuery():
    return jsonify(slow_query)

# Host Server CPU 사용량
@monitoring_ssd_bp.route('/get_HostCSDcpu', methods=['GET'])
def get_HostCSDcpu():
    print("get Host CPU")
    # return jsonify(cpu_usg_info)
    return jsonify(list(cpu_usage_outer))

# Host Server Memory 사용량
@monitoring_ssd_bp.route('/get_HostCSDMemory', methods=['GET'])
def get_HostCSDMemory():
    # print("get Host CSD Memory")
    # return jsonify(memory_usg_info)
    return jsonify(list(memory_usage_outer))

# Host Server Network 사용량
@monitoring_ssd_bp.route('/get_HostCSDNetwork', methods=['GET'])
def get_HostCSDNetwork():
    # print("get Host CSD Network")
    # return jsonify(network_usage_info)
    return jsonify(list(network_usage_outer))

# Host Server Power 사용량
@monitoring_ssd_bp.route('/get_HostCSDPower', methods=['GET'])
def get_HostCSDPower():
    # print("get Host CSD Power")
    # return jsonify(power_usg_info)
    return jsonify(list(power_usage_outer))

# Host Server Disk I/O 사용량
@monitoring_ssd_bp.route('/get_DiskUsage', methods=['GET'])
def get_DiskUsage():
    # return jsonify(disk_usage)
    return jsonify(list(disk_usage_outer))